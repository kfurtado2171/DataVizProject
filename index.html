<!-- U.S. Accidents (2016-2023) -->
<!-- CIS 568 Project -->
<!-- Group 12 -->
<!-- Kyle Furtado & Jonathan Carreiro -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="./libs/d3.js"></script>
    <script src="libs/d3jstopojson.v1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.2/dist/echarts.min.js"></script>

    <title>U.S. Accidents (2016-2023)</title>

    <style>
        /* h1 & h3 formatting */
        h1,h3 {
            text-align: center
        }

        /* container formatting */
        .container{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* svg formatting */
        .svg {
            width: 1250px;
            height: 750px;
            border: 1px solid #000;
            margin: 10px;
        }

    </style>
</head>

<body>
    <!-- page headings -->
    <h1>U.S. Accidents (2016-2023)</h1>
    <h3>Kyle Furtado & Jonathan Carreiro</h3>

    <!-- svg container -->
    <div class="container">
        <h1>Choropleth of U.S. Accidents (2016-2023)</h1>
        <div class="fig1"></div>
        <h1>Bar Chart of U.S. Accidents (2016-2023)</h1>
        <div id="fig2" style="width: 85%; height: 750px;"></div>


        <!-- choropleth svg creation -->
<!--        <svg id="svg-choropleth" class="svg">-->


<!--        </svg>-->

<!--        <h1>Bar Chart of U.S. Accidents (2016-2023)</h1>-->
<!--        &lt;!&ndash; barchart svg creation &ndash;&gt;-->
<!--        <svg id="svg-barchart" class="svg">-->

<!--        </svg>-->

    </div>

    <script>
        // dimension of the page
        const window_dims = {
            width: window.innerWidth,
            height: window.innerHeight
        };

        const svgWidth = window_dims.width/2;
        const svgHeight = window_dims.width/3;


        let svg = d3.select('svg');
        let state_2016_json = "data/2016_state_data.topojson";
        let projection = d3.geoAlbersUsa() //d3.geoAlbersUsa().scale(1300).translate([500, 400])

        //data[0] is loaded data from d3.json(state_2016_json) in promise
        Promise.all([d3.json(state_2016_json)], // asynchronous load of both data sources using promise.all()
            d3.autoType())                                // Auto formatting data
            .then(main)                                   // when data loaded, function main runs.
            .catch(function (error) {
                console.error("Error loading TopoJSON data:", error);
            });


        // -----------------------------CHOROPLETH-----------------------------
        function main(data){
            // Load topojson data
            const accident_data = data[0];
            //console.log(accident_data)

            const generateChoropleth = (topo_data,containerName,width,height,margin=30)=> {
                const svg = d3.select(containerName).append("svg")
                    .attr("width", width)
                    .attr("height", height);

                const geojson = topojson.feature(topo_data, topo_data.objects['2016_state_data']);

                //console.log(geojson)
                const geo_generator = d3.geoPath().projection(projection, geojson);

                const colorInterpolator = d3.interpolateRgbBasis(['#d73027','#fc8d59','#fee090','#e0f3f8','#91bfdb','#4575b4'])

                // if the data is scaled using log scale
                const logScale = d3.scaleLog()
                    .domain(d3.extent(geojson.features, (d) => {
                        return d['properties']['Total Accidents']
                    }))

                // if the data is scaled using linear scale
                const linearScale = d3.scaleLinear()
                    .domain(d3.extent(geojson.features, (d) => {
                        return d['properties']['Total Accidents']
                    }))

                svg.selectAll("path")
                    .data(geojson.features)
                    .enter()
                    .append("path")
                    .attr("d", d => {
                        //console.log(d)
                        //console.log(geo_generator(d));
                        return geo_generator(d)
                    })
                    //.attr("fill", d => colorInterpolator(linearScale(d.properties['Total Accidents'])))
                    .attr("fill", d => colorInterpolator(logScale(d.properties['Total Accidents'])))
                    //.attr("fill", "none")
                    //.attr("stroke","black")
                    .attr("stroke-width","0.5")

                    //console.log(geojson.features[1].properties['Total Accidents'])
                    //console.log(geojson['properties']['Total Accidents'])

                    // .on("mouseenter", (m, d) => {
                    //     tooltip.transition()
                    //         .duration(200)
                    //         .style("opacity", .9)
                    //     tooltip.html(d['properties']['TOWN'] + " POPULATION: " + d['properties']['POP1980'])
                    //         .style("left", m.clientX + "px")
                    //         .style("top", m.clientY + "px");
                    // })
                    // .on("mousemove", (m, d) => {
                    //     tooltip.style("opacity", .9)
                    // })
                    // .on("mouseout", (m, d) => {
                    //     tooltip.transition()
                    //         .duration(400)
                    //         .style("opacity", 0)
                    // })

            }
            generateChoropleth(accident_data,".fig1",900,700)



            // -----------------------------BAR CHART-----------------------------
            // Dummy data for the example
            // const bar_data = [
            //     {y01: 120, y02: 180, y03: 100, y04: 77},
            //     {y01: 60,  y02: 185, y03: 105, y04: 123},
            //     {y01: 100, y02: 215, y03: 110, y04: 131},
            //     {y01: 80,  y02: 230, y03: 105, y04: 231},
            //     {y01: 120, y02: 240, y03: 105, y04: 44}
            // ];


            // Initialize ECharts instance
            var echartsInstance = echarts.init(document.getElementById('fig2'));

            var customColors = [
                '#01084f',
                '#391954',
                '#631e50',
                '#a73c5a',
                '#ff7954',
                '#FDC2B0',
                '#F4CB67',
                '#d6d727',
                '#a7e237',
                '#37bd79',
                '#79ccb3',
                '#92cad1',
                '#308fac'
            ];

            // ECharts option
            var option = {
                color: customColors, // Set the custom color palette
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {},
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    data: ['AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT',]
                    //data: ['AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 'DC', 'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND', 'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY']
                },

                series: [
                    {
                        name: 'Amenity',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [321, 302, 301, 334, 390, 330, 320]
                    },
                    {
                        name: 'Bump',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [120, 132, 101, 134, 90, 230, 210]
                    },
                    {
                        name: 'Crossing',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [220, 182, 191, 234, 290, 330, 310]
                    },
                    {
                        name: 'Give_Way',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [150, 212, 201, 154, 190, 330, 410]
                    },
                    {
                        name: 'Junction',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [820, 832, 901, 934, 1290, 1330, 1320]
                    },
                    {
                        name: 'No_Exit',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [952, 1125, 543, 3520, 1477, 820, 1430]
                    },
                    {
                        name: 'Railway',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [862, 446, 2015, 1025, 389, 533, 262]
                    },
                    {
                        name: 'Roundabout',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [245, 724, 2437, 243, 4587, 1722, 1472]
                    },
                    {
                        name: 'Station',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [432, 1476, 2574, 786, 732, 435, 3573]
                    },
                    {
                        name: 'Stop',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [1054, 367, 2345, 532, 3453, 2587, 234]
                    },
                    {
                        name: 'Traffic_Calming',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [324, 2420, 424, 3742, 245, 2420, 3750]
                    },
                    {
                        name: 'Traffic_Signal',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [214, 832, 573, 243, 3542, 1534, 4243]
                    },
                    {
                        name: 'Turning_Loop',
                        type: 'bar',
                        stack: 'total',
                        label: {
                            show: false
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        data: [945, 674, 762, 543, 1125, 3753, 1235]
                    }
                ]
            };

            // Set the option and render the chart
            echartsInstance.setOption(option);
        }



    </script>

</body>

</html>
